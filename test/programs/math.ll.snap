; ModuleID = 'whacko'
source_filename = "whacko"
target triple = "wasm32-wasi"

declare ptr @__whacko_gc_alloc(i32, i32)

declare void @__whacko_gc_store_field_ptr(i32, ptr, ptr, ptr)

define void @_start() {
entry:
  %"alloca~0" = alloca ptr, align 8
  %"result~297" = call ptr @__whacko_gc_alloc(i32 1, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32, i32 }, ptr null, i32 1) to i32))
  call void @"callable:[test/programs/math.wo]Foo.constructor;methodType:classType:[test/programs/math.wo]Foo<>#()=>voidType"(ptr %"result~297")
  store ptr %"result~297", ptr %"alloca~0", align 8
  %"267~inst" = call float @asinf(float 1.000000e+00)
  %"271~inst" = call double @"callable:[test/programs/math.wo]bar;functionType:()=>f64Type"()
  %"274~inst" = fsub double %"271~inst", 1.000000e+00
  %"279~inst" = call double @asin(double %"274~inst")
  %"280~inst" = load ptr, ptr %"alloca~0", align 8
  tail call void @free(ptr %"280~inst")
  ret void
}

define void @"callable:[test/programs/math.wo]Foo.constructor;methodType:classType:[test/programs/math.wo]Foo<>#()=>voidType"(ptr %0) {
entry:
  %"alloca~0" = alloca ptr, align 8
  store ptr %0, ptr %"alloca~0", align 8
  %"gep~298" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  %"288~inst" = load i32, ptr %"gep~298", align 4
  %"gep~299" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  store i32 0, ptr %"gep~299", align 4
  ret void
}

declare float @asinf(float)

define double @"callable:[test/programs/math.wo]bar;functionType:()=>f64Type"() {
entry:
  ret double 2.000000e+00
}

declare double @asin(double)

declare void @free(ptr) #0

declare void @__whacko_gc_visit(ptr)

define void @__visit_whacko_object(ptr %0) {
"entry~300":
  %"typeGEP~302" = getelementptr { ptr, ptr, i32, i32 }, ptr %0, i32 2
  %1 = load i32, ptr %"typeGEP~302", align 4
  switch i32 %1, label %"unreachable~301" [
    i32 1, label %"classType:[test/programs/math.wo]Foo<>"
    i32 2, label %"classType:[std/String.wo]String<>"
  ]

"unreachable~301":                                ; preds = %"entry~300"
  unreachable

"classType:[test/programs/math.wo]Foo<>":         ; preds = %"entry~300"
  ret void

"classType:[std/String.wo]String<>":              ; preds = %"entry~300"
  ret void
}

attributes #0 = { "alloc-family"="malloc" "allockind"="free" }
