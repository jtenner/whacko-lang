; ModuleID = 'whacko'
source_filename = "whacko"
target triple = "wasm32-wasi"

declare void @__whacko_gc_initialize()

declare ptr @__whacko_gc_alloc(i32, i32)

declare void @__whacko_gc_store_field_ptr(i32, ptr, ptr, ptr)

define void @_start() gc "shadow-stack" {
entry:
  call void @__whacko_gc_initialize()
  %"generated-alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"generated-alloca~0", ptr null)
  %"variable-a-alloca~1" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"variable-a-alloca~1", ptr null)
  %"result~646" = call ptr @__whacko_gc_alloc(i32 2, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32, ptr, i32 }, ptr null, i32 1) to i32))
  store ptr %"result~646", ptr %"generated-alloca~0", align 8
  call void @"callable:[std/array.wo]Array.constructor;methodType:classType:[std/array.wo]Array<i32Type>#(usizeType)=>voidType"(ptr %"result~646", i32 100)
  store ptr %"result~646", ptr %"variable-a-alloca~1", align 8
  ret void
}

define void @"callable:[std/array.wo]Array.__gc_visit;methodType:classType:[std/array.wo]Array<i32Type>#()=>voidType"(ptr %0) gc "shadow-stack" {
entry:
  %"generated-alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"generated-alloca~0", ptr null)
  store ptr %0, ptr %"generated-alloca~0", align 8
  ret void
}

define void @"callable:[std/array.wo]Array.constructor;methodType:classType:[std/array.wo]Array<i32Type>#(usizeType)=>voidType"(ptr %0, i32 %1) gc "shadow-stack" {
entry:
  %"generated-alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"generated-alloca~0", ptr null)
  store ptr %0, ptr %"generated-alloca~0", align 8
  %"generated-alloca~1" = alloca i32, align 4
  store i32 %1, ptr %"generated-alloca~1", align 4
  %"variable-overhead-alloca~2" = alloca i32, align 4
  %"603~inst" = load ptr, ptr %"generated-alloca~0", align 8
  %"gep~647" = getelementptr { ptr, ptr, i32, i32, ptr, i32 }, ptr %"603~inst", i32 0, i32 4
  %"604~inst" = load ptr, ptr %"gep~647", align 8
  %"608~inst" = load i32, ptr %"variable-overhead-alloca~2", align 4
  %"609~inst" = load i32, ptr %"generated-alloca~1", align 4
  %"621~inst" = mul i32 %"609~inst", 32
  %"622~inst" = add i32 %"608~inst", %"621~inst"
  %"627~inst" = call ptr @__whacko_gc_alloc(i32 1, i32 %"622~inst")
  %"gep~648" = getelementptr { ptr, ptr, i32, i32, ptr, i32 }, ptr %"603~inst", i32 0, i32 4
  call void @__whacko_gc_store_field_ptr(i32 1, ptr %"603~inst", ptr %"627~inst", ptr %"gep~648")
  %"631~inst" = load ptr, ptr %"generated-alloca~0", align 8
  %"gep~649" = getelementptr { ptr, ptr, i32, i32, ptr, i32 }, ptr %"631~inst", i32 0, i32 5
  %"632~inst" = load i32, ptr %"gep~649", align 4
  %"gep~650" = getelementptr { ptr, ptr, i32, i32, ptr, i32 }, ptr %"631~inst", i32 0, i32 5
  store i32 0, ptr %"gep~650", align 4
  ret void
}

; Function Attrs: nounwind
declare void @llvm.gcroot(ptr, ptr) #0

declare void @__whacko_gc_visit(ptr)

define void @__visit_whacko_object(ptr %0) {
"entry~651":
  %"typeGEP~653" = getelementptr { ptr, ptr, i32, i32 }, ptr %0, i32 2
  %1 = load i32, ptr %"typeGEP~653", align 4
  switch i32 %1, label %"unreachable~652" [
    i32 1, label %"classType:[std/buffer.wo]ArrayBuffer<>"
    i32 2, label %"classType:[std/array.wo]Array<i32Type>"
    i32 3, label %"classType:[std/String.wo]String<>"
  ]

"unreachable~652":                                ; preds = %"entry~651"
  unreachable

"classType:[std/buffer.wo]ArrayBuffer<>":         ; preds = %"entry~651"
  ret void

"classType:[std/array.wo]Array<i32Type>":         ; preds = %"entry~651"
  %"gep~654" = getelementptr { ptr, ptr, i32, i32, ptr, i32 }, ptr %0, i32 0
  %"load~655" = load ptr, ptr %"gep~654", align 8
  call void @__whacko_gc_visit(ptr %"load~655")
  call void @"callable:[std/array.wo]Array.__gc_visit;methodType:classType:[std/array.wo]Array<i32Type>#()=>voidType"(ptr %0)
  ret void

"classType:[std/String.wo]String<>":              ; preds = %"entry~651"
  ret void
}

attributes #0 = { nounwind }
