; ModuleID = 'whacko'
source_filename = "whacko"
target triple = "wasm32-wasi"

declare ptr @__whacko_gc_alloc(i32, i32)

declare void @__whacko_gc_store_field_ptr(i32, ptr, ptr, ptr)

define void @_start() {
entry:
  %"alloca~0" = alloca ptr, align 8
  %"alloca~1" = alloca ptr, align 8
  %"result~413" = call ptr @__whacko_gc_alloc(i32 1, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32, i32 }, ptr null, i32 1) to i32))
  call void @"callable:[test/programs/implements.wo]MyClass.constructor;methodType:classType:[test/programs/implements.wo]MyClass<>#()=>voidType"(ptr %"result~413")
  store ptr %"result~413", ptr %"alloca~0", align 8
  %"result~415" = call ptr @__whacko_gc_alloc(i32 2, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32, i32 }, ptr null, i32 1) to i32))
  call void @"callable:[test/programs/implements.wo]MyOtherClass.constructor;methodType:classType:[test/programs/implements.wo]MyOtherClass<>#()=>voidType"(ptr %"result~415")
  store ptr %"result~415", ptr %"alloca~1", align 8
  %"329~inst" = load ptr, ptr %"alloca~0", align 8
  %"333~inst" = call i32 @useMyInterface(ptr %"329~inst")
  ret void
}

define void @"callable:[test/programs/implements.wo]MyClass.constructor;methodType:classType:[test/programs/implements.wo]MyClass<>#()=>voidType"(ptr %0) {
entry:
  %"alloca~0" = alloca ptr, align 8
  store ptr %0, ptr %"alloca~0", align 8
  %"gep~416" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  %"362~inst" = load i32, ptr %"gep~416", align 4
  %"gep~417" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  store i32 42, ptr %"gep~417", align 4
  ret void
}

define void @"callable:[test/programs/implements.wo]MyOtherClass.constructor;methodType:classType:[test/programs/implements.wo]MyOtherClass<>#()=>voidType"(ptr %0) {
entry:
  %"alloca~0" = alloca ptr, align 8
  store ptr %0, ptr %"alloca~0", align 8
  %"gep~418" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  %"353~inst" = load i32, ptr %"gep~418", align 4
  %"gep~419" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  store i32 42, ptr %"gep~419", align 4
  ret void
}

define i32 @useMyInterface(ptr %0) {
entry:
  %"alloca~0" = alloca ptr, align 8
  store ptr %0, ptr %"alloca~0", align 8
  %"trampolineCall~420" = call ptr @"interfaceType:[test/programs/implements.wo]MyInterface<>#field"(ptr %"alloca~0")
  %"336~inst" = load i32, ptr %"trampolineCall~420", align 4
  %"trampolineCall~421" = call ptr @"interfaceType:[test/programs/implements.wo]MyInterface<>#field"(ptr %"alloca~0")
  store i32 0, ptr %"trampolineCall~421", align 4
  %"343~inst" = load ptr, ptr %"alloca~0", align 8
  %"350~inst" = call i32 @"callable:[test/programs/implements.wo]MyInterface.method;methodType:interfaceType:[test/programs/implements.wo]MyInterface<>#(i64Type)=>i32Type"(ptr %"343~inst", i64 69)
  ret i32 %"350~inst"
}

define i32 @"callable:[test/programs/implements.wo]MyInterface.method;methodType:interfaceType:[test/programs/implements.wo]MyInterface<>#(i64Type)=>i32Type"(ptr %0, i64 %1) {
"entry~431":
  %"typeGEP~432" = getelementptr { ptr, ptr, i32, i32 }, ptr %0, i32 2
  %2 = load i32, ptr %"typeGEP~432", align 4
  switch i32 %2, label %"default~433" [
    i32 1, label %"callable:[test/programs/implements.wo]MyClass.method;methodType:classType:[test/programs/implements.wo]MyClass<>#(i64Type)=>i32Type"
    i32 2, label %"callable:[test/programs/implements.wo]MyOtherClass.method;methodType:classType:[test/programs/implements.wo]MyOtherClass<>#(i64Type)=>i32Type"
  ]

"default~433":                                    ; preds = %"entry~431"
  unreachable

"callable:[test/programs/implements.wo]MyClass.method;methodType:classType:[test/programs/implements.wo]MyClass<>#(i64Type)=>i32Type": ; preds = %"entry~431"
  %3 = call i32 @"callable:[test/programs/implements.wo]MyClass.method;methodType:classType:[test/programs/implements.wo]MyClass<>#(i64Type)=>i32Type"(ptr %0, i64 %1)
  ret i32 %3

"callable:[test/programs/implements.wo]MyOtherClass.method;methodType:classType:[test/programs/implements.wo]MyOtherClass<>#(i64Type)=>i32Type": ; preds = %"entry~431"
  %4 = call i32 @"callable:[test/programs/implements.wo]MyOtherClass.method;methodType:classType:[test/programs/implements.wo]MyOtherClass<>#(i64Type)=>i32Type"(ptr %0, i64 %1)
  ret i32 %4
}

define i32 @"callable:[test/programs/implements.wo]MyClass.method;methodType:classType:[test/programs/implements.wo]MyClass<>#(i64Type)=>i32Type"(ptr %0, i64 %1) {
entry:
  %"alloca~0" = alloca ptr, align 8
  store ptr %0, ptr %"alloca~0", align 8
  %"alloca~1" = alloca i64, align 8
  store i64 %1, ptr %"alloca~1", align 4
  %"gep~422" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  %"394~inst" = load i32, ptr %"gep~422", align 4
  %"395~inst" = load i64, ptr %"alloca~1", align 4
  %"399~inst" = trunc i64 %"395~inst" to i32
  %"gep~423" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  store i32 %"399~inst", ptr %"gep~423", align 4
  ret i32 2
}

define i32 @"callable:[test/programs/implements.wo]MyOtherClass.method;methodType:classType:[test/programs/implements.wo]MyOtherClass<>#(i64Type)=>i32Type"(ptr %0, i64 %1) {
entry:
  %"alloca~0" = alloca ptr, align 8
  store ptr %0, ptr %"alloca~0", align 8
  %"alloca~1" = alloca i64, align 8
  store i64 %1, ptr %"alloca~1", align 4
  %"gep~424" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  %"380~inst" = load i32, ptr %"gep~424", align 4
  %"381~inst" = load i64, ptr %"alloca~1", align 4
  %"385~inst" = trunc i64 %"381~inst" to i32
  %"gep~425" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %"alloca~0", i32 2
  store i32 %"385~inst", ptr %"gep~425", align 4
  ret i32 1
}

define ptr @"interfaceType:[test/programs/implements.wo]MyInterface<>#field"(ptr %0) {
"entry~426":
  %"typeGEP~427" = getelementptr { ptr, ptr, i32, i32 }, ptr %0, i32 2
  %1 = load i32, ptr %"typeGEP~427", align 4
  switch i32 %1, label %"default~428" [
    i32 1, label %"classType:[test/programs/implements.wo]MyClass<>"
    i32 2, label %"classType:[test/programs/implements.wo]MyOtherClass<>"
  ]

"default~428":                                    ; preds = %"entry~426"
  unreachable

"classType:[test/programs/implements.wo]MyClass<>": ; preds = %"entry~426"
  %"resultGEP~429" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %0, i32 2
  ret ptr %"resultGEP~429"

"classType:[test/programs/implements.wo]MyOtherClass<>": ; preds = %"entry~426"
  %"resultGEP~430" = getelementptr { ptr, ptr, i32, i32, i32 }, ptr %0, i32 2
  ret ptr %"resultGEP~430"
}

declare void @__whacko_gc_visit(ptr)

define void @__visit_whacko_object(ptr %0) {
"entry~434":
  %"typeGEP~436" = getelementptr { ptr, ptr, i32, i32 }, ptr %0, i32 2
  %1 = load i32, ptr %"typeGEP~436", align 4
  switch i32 %1, label %"unreachable~435" [
    i32 1, label %"classType:[test/programs/implements.wo]MyClass<>"
    i32 2, label %"classType:[test/programs/implements.wo]MyOtherClass<>"
    i32 3, label %"classType:[std/String.wo]String<>"
  ]

"unreachable~435":                                ; preds = %"entry~434"
  unreachable

"classType:[test/programs/implements.wo]MyClass<>": ; preds = %"entry~434"
  ret void

"classType:[test/programs/implements.wo]MyOtherClass<>": ; preds = %"entry~434"
  ret void

"classType:[std/String.wo]String<>":              ; preds = %"entry~434"
  ret void
}
