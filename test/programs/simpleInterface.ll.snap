; ModuleID = 'whacko'
source_filename = "whacko"
target triple = "wasm32-wasi"

declare void @__whacko_gc_initialize()

declare ptr @__whacko_gc_alloc(i32, i32)

declare void @__whacko_gc_store_field_ptr(i32, ptr, ptr, ptr)

define void @_start() gc "shadow-stack" {
entry:
  call void @__whacko_gc_initialize()
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  %"alloca~1" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~1", ptr null)
  %"alloca~2" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~2", ptr null)
  %"alloca~3" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~3", ptr null)
  %"alloca~4" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~4", ptr null)
  %"alloca~5" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~5", ptr null)
  %"alloca~6" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~6", ptr null)
  %"alloca~7" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~7", ptr null)
  %"result~237" = call ptr @__whacko_gc_alloc(i32 1, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32 }, ptr null, i32 1) to i32))
  call void @"callable:[test/programs/simpleInterface.wo]A.constructor;methodType:classType:[test/programs/simpleInterface.wo]A<>#()=>voidType"(ptr %"result~237")
  store ptr %"result~237", ptr %"alloca~0", align 8
  %"result~239" = call ptr @__whacko_gc_alloc(i32 2, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32 }, ptr null, i32 1) to i32))
  call void @"callable:[test/programs/simpleInterface.wo]B.constructor;methodType:classType:[test/programs/simpleInterface.wo]B<>#()=>voidType"(ptr %"result~239")
  store ptr %"result~239", ptr %"alloca~1", align 8
  %"result~241" = call ptr @__whacko_gc_alloc(i32 3, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32 }, ptr null, i32 1) to i32))
  call void @"callable:[test/programs/simpleInterface.wo]C.constructor;methodType:classType:[test/programs/simpleInterface.wo]C<>#()=>voidType"(ptr %"result~241")
  store ptr %"result~241", ptr %"alloca~2", align 8
  %"result~243" = call ptr @__whacko_gc_alloc(i32 4, i32 ptrtoint (ptr getelementptr ({ ptr, ptr, i32, i32 }, ptr null, i32 1) to i32))
  call void @"callable:[test/programs/simpleInterface.wo]D.constructor;methodType:classType:[test/programs/simpleInterface.wo]D<>#()=>voidType"(ptr %"result~243")
  store ptr %"result~243", ptr %"alloca~3", align 8
  %"107~inst" = load ptr, ptr %"alloca~0", align 8
  store ptr %"107~inst", ptr %"alloca~4", align 8
  %"112~inst" = call i32 @callTest(ptr %"107~inst")
  %"118~inst" = icmp eq i32 %"112~inst", 42
  br i1 %"118~inst", label %"next~121", label %"falsy~120"

"falsy~120":                                      ; preds = %entry
  unreachable

"next~121":                                       ; preds = %entry
  %"125~inst" = load ptr, ptr %"alloca~1", align 8
  store ptr %"125~inst", ptr %"alloca~5", align 8
  %"129~inst" = call i32 @callTest(ptr %"125~inst")
  %"135~inst" = icmp eq i32 %"129~inst", 69
  br i1 %"135~inst", label %"next~138", label %"falsy~137"

"falsy~137":                                      ; preds = %"next~121"
  unreachable

"next~138":                                       ; preds = %"next~121"
  %"142~inst" = load ptr, ptr %"alloca~2", align 8
  store ptr %"142~inst", ptr %"alloca~6", align 8
  %"146~inst" = call i32 @callTest(ptr %"142~inst")
  %"152~inst" = icmp eq i32 %"146~inst", 123
  br i1 %"152~inst", label %"next~155", label %"falsy~154"

"falsy~154":                                      ; preds = %"next~138"
  unreachable

"next~155":                                       ; preds = %"next~138"
  %"159~inst" = load ptr, ptr %"alloca~3", align 8
  store ptr %"159~inst", ptr %"alloca~7", align 8
  %"163~inst" = call i32 @callTest(ptr %"159~inst")
  %"169~inst" = icmp eq i32 %"163~inst", 456
  br i1 %"169~inst", label %"next~172", label %"falsy~171"

"falsy~171":                                      ; preds = %"next~155"
  unreachable

"next~172":                                       ; preds = %"next~155"
  ret void
}

define void @"callable:[test/programs/simpleInterface.wo]A.constructor;methodType:classType:[test/programs/simpleInterface.wo]A<>#()=>voidType"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret void
}

define void @"callable:[test/programs/simpleInterface.wo]B.constructor;methodType:classType:[test/programs/simpleInterface.wo]B<>#()=>voidType"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret void
}

define void @"callable:[test/programs/simpleInterface.wo]C.constructor;methodType:classType:[test/programs/simpleInterface.wo]C<>#()=>voidType"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret void
}

define void @"callable:[test/programs/simpleInterface.wo]D.constructor;methodType:classType:[test/programs/simpleInterface.wo]D<>#()=>voidType"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret void
}

define i32 @callTest(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  %"178~inst" = load ptr, ptr %"alloca~0", align 8
  %"182~inst" = call i32 @"callable:[test/programs/simpleInterface.wo]Test.test;methodType:interfaceType:[test/programs/simpleInterface.wo]Test<>#()=>i32Type"(ptr %"178~inst")
  ret i32 %"182~inst"
}

define i32 @"callable:[test/programs/simpleInterface.wo]Test.test;methodType:interfaceType:[test/programs/simpleInterface.wo]Test<>#()=>i32Type"(ptr %0) {
"entry~244":
  %"typeGEP~245" = getelementptr { ptr, ptr, i32, i32 }, ptr %0, i32 2
  %1 = load i32, ptr %"typeGEP~245", align 4
  switch i32 %1, label %"default~246" [
    i32 1, label %"callable:[test/programs/simpleInterface.wo]A.test;methodType:classType:[test/programs/simpleInterface.wo]A<>#()=>i32Type"
    i32 2, label %"callable:[test/programs/simpleInterface.wo]B.test;methodType:classType:[test/programs/simpleInterface.wo]B<>#()=>i32Type"
    i32 3, label %"callable:[test/programs/simpleInterface.wo]C.test;methodType:classType:[test/programs/simpleInterface.wo]C<>#()=>i32Type"
    i32 4, label %"callable:[test/programs/simpleInterface.wo]D.test;methodType:classType:[test/programs/simpleInterface.wo]D<>#()=>i32Type"
  ]

"default~246":                                    ; preds = %"entry~244"
  unreachable

"callable:[test/programs/simpleInterface.wo]A.test;methodType:classType:[test/programs/simpleInterface.wo]A<>#()=>i32Type": ; preds = %"entry~244"
  %2 = call i32 @"callable:[test/programs/simpleInterface.wo]A.test;methodType:classType:[test/programs/simpleInterface.wo]A<>#()=>i32Type"(ptr %0)
  ret i32 %2

"callable:[test/programs/simpleInterface.wo]B.test;methodType:classType:[test/programs/simpleInterface.wo]B<>#()=>i32Type": ; preds = %"entry~244"
  %3 = call i32 @"callable:[test/programs/simpleInterface.wo]B.test;methodType:classType:[test/programs/simpleInterface.wo]B<>#()=>i32Type"(ptr %0)
  ret i32 %3

"callable:[test/programs/simpleInterface.wo]C.test;methodType:classType:[test/programs/simpleInterface.wo]C<>#()=>i32Type": ; preds = %"entry~244"
  %4 = call i32 @"callable:[test/programs/simpleInterface.wo]C.test;methodType:classType:[test/programs/simpleInterface.wo]C<>#()=>i32Type"(ptr %0)
  ret i32 %4

"callable:[test/programs/simpleInterface.wo]D.test;methodType:classType:[test/programs/simpleInterface.wo]D<>#()=>i32Type": ; preds = %"entry~244"
  %5 = call i32 @"callable:[test/programs/simpleInterface.wo]D.test;methodType:classType:[test/programs/simpleInterface.wo]D<>#()=>i32Type"(ptr %0)
  ret i32 %5
}

define i32 @"callable:[test/programs/simpleInterface.wo]A.test;methodType:classType:[test/programs/simpleInterface.wo]A<>#()=>i32Type"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret i32 42
}

define i32 @"callable:[test/programs/simpleInterface.wo]B.test;methodType:classType:[test/programs/simpleInterface.wo]B<>#()=>i32Type"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret i32 69
}

define i32 @"callable:[test/programs/simpleInterface.wo]C.test;methodType:classType:[test/programs/simpleInterface.wo]C<>#()=>i32Type"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret i32 123
}

define i32 @"callable:[test/programs/simpleInterface.wo]D.test;methodType:classType:[test/programs/simpleInterface.wo]D<>#()=>i32Type"(ptr %0) gc "shadow-stack" {
entry:
  %"alloca~0" = alloca ptr, align 8
  call void @llvm.gcroot(ptr %"alloca~0", ptr null)
  store ptr %0, ptr %"alloca~0", align 8
  ret i32 456
}

; Function Attrs: nounwind
declare void @llvm.gcroot(ptr, ptr) #0

declare void @__whacko_gc_visit(ptr)

define void @__visit_whacko_object(ptr %0) {
"entry~247":
  %"typeGEP~249" = getelementptr { ptr, ptr, i32, i32 }, ptr %0, i32 2
  %1 = load i32, ptr %"typeGEP~249", align 4
  switch i32 %1, label %"unreachable~248" [
    i32 1, label %"classType:[test/programs/simpleInterface.wo]A<>"
    i32 2, label %"classType:[test/programs/simpleInterface.wo]B<>"
    i32 3, label %"classType:[test/programs/simpleInterface.wo]C<>"
    i32 4, label %"classType:[test/programs/simpleInterface.wo]D<>"
    i32 5, label %"classType:[std/String.wo]String<>"
  ]

"unreachable~248":                                ; preds = %"entry~247"
  unreachable

"classType:[test/programs/simpleInterface.wo]A<>": ; preds = %"entry~247"
  ret void

"classType:[test/programs/simpleInterface.wo]B<>": ; preds = %"entry~247"
  ret void

"classType:[test/programs/simpleInterface.wo]C<>": ; preds = %"entry~247"
  ret void

"classType:[test/programs/simpleInterface.wo]D<>": ; preds = %"entry~247"
  ret void

"classType:[std/String.wo]String<>":              ; preds = %"entry~247"
  ret void
}

attributes #0 = { nounwind }
